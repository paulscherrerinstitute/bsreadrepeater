# BSREAD repeater

Receive from configured sources and replay all messages on the configured output sockets.
A single source can be replayed on multiple outputs.
Input sources and output sockets can be added and removed at runtime.


# Binaries for RHEL 7

Todo: add the link.


# Run the application

```
./bsrep <CMDADDR> [CMDFILE]
```

Configuration is done by sending zmq messages to the command socket.
The command socket is a REP socket on `CMDADDR`.

An optional `CMDFILE` can be specified and those commands are applied at start.
The command file contains one command per line.
Example command file:
```
add-source,tcp://source.psi.ch:9900
add-output,tcp://source.psi.ch:9900,tcp://0.0.0.0:4000
add-output,tcp://source.psi.ch:9900,tcp://0.0.0.0:4001
add-source,tcp://source.psi.ch:9901
add-output,tcp://source.psi.ch:9901,tcp://0.0.0.0:4002
```
For a realistic number of sources, the command file is meant to be
generated by tooling, not by hand.


# Commands

All commands are accessible by sending a zmq message to the `REP` socket at `CMDADDR`.


## Add a source

`add-source,SOURCE` where `SOURCE` is e.g. "tcp://source.psi.ch:9999".


## Remove a source

`remove-source,SOURCE`


## Add output to a source

`add-output,SOURCE,OUTPUT`
where `SOURCE` is e.g. "tcp://source.psi.ch:9999"
and `OUTPUT` e.g. "tcp://127.0.0.1:4321".


## Remove output from a source

`remove-output,SOURCE,OUTPUT`


## List configured sources and their outputs

`list-sources`


## Global statistics

`stats`


## Statistics for specific source and its outputs

`stats-source,SOURCE`


## Exit the repeater

Send via a zmq REQ socket the message "exit" to the command socket.


# Planned improvements

* Provide more detailed statistics on command.
* Gather basic statistics from the bsread messages passing by.
